require_relative 'app'
Dir["./db/seeds/*.rb"].each { |rb| require rb }

Sequel.extension :migration

namespace :db do

  desc 'Run migrations in db/migrations'
  task :migrate do

    if ENV['VERSION']
      version = "-M #{ENV['VERSION']}"
    end

    system "sequel -E " +
           "#{version} " +
           "-m db/migrations postgres://#{ENV['DB_USER']}:" +
           "#{ENV['DB_PASSWORD']}@#{ENV['DB_HOST']}:" +
           "#{ENV['DB_PORT']}/#{DB_NAME}"
  end

  desc 'Run seeds'
  task :seeds do
    DBSeed::Base.run_all!
  end

end
