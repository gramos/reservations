require_relative 'app'
Dir["./db/seeds/*.rb"].each { |rb| require rb }

Sequel.extension :migration

namespace :db do

  desc 'Run migrations in db/migrations'
  task :migrate do

    if ENV['VERSION']
      version = "-M #{ENV['VERSION']}"
    end

    system "sequel -E " +
           "#{version} " +
           "-m db/migrations postgres://#{ENV['DB_USER']}:" +
           "#{ENV['DB_PASSWORD']}@#{ENV['DB_HOST']}:" +
           "#{ENV['DB_PORT']}/#{ENV['DB_NAME']}"
  end

  desc 'Delete all tables'
  task :delete do
    DB[:customers].delete
    DB[:addresses].delete
    DB[:reservation_types].delete
    DB[:services].delete
    DB[:scheduled_times].delete
    # DB[:cities].delete
    DB[:drivers].delete
  end

  desc 'Run seeds'
  task :seeds do
    DBSeed::ReservationTypes.run!
    DBSeed::Drivers.run!
    DBSeed::ScheduledTimes.run!
    DBSeed::Services.run!
    DBSeed::Cities.run!
  end

end
